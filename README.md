# Image build

```podman build .```

## Container File
```
FROM ubi9/ubi:9.2-755.1697625012
RUN dnf install -y git
```

# Creating of Lockfile

## Locking `git`

```podman run <ImageID> dnf -q repoquery --installed git > lock-file.txt```

## Locking Direct Depenencies of `git`

```podman run <ImageID> dnf -q repoquery --installed git --requires --resolve >> lock-file.txt```

## Locking All Dependencies of `git`

```podman run <ImageID> dnf -q repoquery --installed git --requires --resolve --recursive >> lock-file.txt```

# Image Build with `lock-file.txt`

It is required to import lock-file to the image. The example uses a simple copy from local project, but it can be
replaced by file download. The workflow is functional even when lock-file is empty => the same Container file can be
used for initial build.

```podman build install-lock-file/```

## Container File

```
FROM ubi9/ubi:9.2-755.1697625012
COPY lock-file.txt /tmp/lock-file.txt
RUN dnf install -y git $(cat /tmp/lock-file.txt)
```

# Check for Updates of Locked RPMs

The workflow uses image generated by `Image build with lock-file` chapter (The image contains /tmp/lock-file.txt)

DNF has command that checks update availability `dnf -q check-update <rpm_names>`. If updates are available then
the command returns code is 100. If there is no update then return code is 0.

## Convert `lock-file.txt` to RPMs Names

`dnf -q repoquery --installed $(cat /tmp/lock-file.txt) --qf "%{name}" | tr "\n" " "`

## Run Update Check

```podman run <ImageID> /usr/bin/bash -c 'dnf -q check-update $(dnf -q repoquery --installed $(cat /tmp/lock-file.txt) --qf "%{name}" | tr "\n" " ")'```
